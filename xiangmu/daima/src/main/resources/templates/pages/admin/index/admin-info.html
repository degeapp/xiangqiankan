<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>网站后台管理模版</title>
<link rel="stylesheet" type="text/css"
	href="../../static/admin/layui/css/layui.css" />
<link rel="stylesheet" type="text/css"
	href="../../static/admin/css/admin.css" />
</head>
<body>
	<div class="layui-tab page-content-wrap">
		<ul class="layui-tab-title">
			<li class="layui-this">修改资料</li>
			<li>修改密码</li>
		</ul>
		<div class="layui-tab-content">
			<div class="layui-tab-item layui-show">
				<form class="layui-form" id="form1" style="width: 90%; padding-top: 20px;">
					<div class="layui-form-item">
						<label class="layui-form-label">ID：</label>
						<div class="layui-input-block">
							<input type="text" name="id" disabled autocomplete="off"
								class="layui-input layui-disabled" id="id" value="">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">用户名：</label>
						<div class="layui-input-block">
							<input type="text" name="username" disabled autocomplete="off"
								class="layui-input layui-disabled username" value="">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">姓名：</label>
						<div class="layui-input-block">
							<input type="text" name="boss" required lay-verify="required"
								placeholder="请输入管理员姓名" autocomplete="off" class="layui-input"
								id="boss" value="">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">公司地点：</label>
						<div class="layui-input-block">
							<input type="text" name="address" id="address" required
								lay-verify="required" placeholder="请输入公司地址" autocomplete="off"
								class="layui-input" value="">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">公司电话：</label>
						<div class="layui-input-block">
							<input type="text" name="tel" id="tel" required
								lay-verify="required" placeholder="请输入公司电话" autocomplete="off"
								class="layui-input" value="">
						</div>
					</div>
					<div class="layui-form-item layui-form-text">
						<label class="layui-form-label">企业简介：</label>
						<div class="layui-input-block">
							<textarea name="jianjie" id="jianjie" placeholder="请输入企业简介"
								class="layui-textarea"></textarea>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-input-block">
							<input type="button" class="layui-btn layui-btn-normal"
								onclick="submit1()" value="修改">
						</div>
					</div>
				</form>
			</div>
			<div class="layui-tab-item">
				<form class="layui-form" style="width: 90%; padding-top: 20px;">
					<div class="layui-form-item">
						<label class="layui-form-label">用户名：</label>
						<div class="layui-input-block">
							<input type="text" name="username" disabled autocomplete="off"
								class="layui-input layui-disabled username" value="123">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">旧密码：</label>
						<div class="layui-input-block">
							<input type="password" name="oldpassword" id="oldpassword"
								required lay-verify="required" placeholder="请输入密码"
								autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">新密码：</label>
						<div class="layui-input-block">
							<input type="password" name="password" id="password" required
								lay-verify="required" placeholder="请输入密码" autocomplete="off"
								class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">重复密码：</label>
						<div class="layui-input-block">
							<input type="password" name="password1" id="password1" required
								lay-verify="required" placeholder="请输入密码" autocomplete="off"
								class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-input-block">
							<input type="button" class="layui-btn layui-btn-normal"
								onclick="login()" value="修改">
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script src="../../static/admin/layui/layui.js" type="text/javascript"
		charset="utf-8"></script>
	<script type="text/javascript" src="../../js/jquery-1.4.2.js"></script>
	<script type="text/javascript" src="../../js/tiaozhuan.js"></script>
	<script type="text/javascript" src="../../js/grtiaozhuan.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			var zt = 1;
			var username = getCookie("username");

			$.ajax({
				url : "company/doFindCompanyByUserName?username=" + username,//后台请求的数据，用的是PHP
				dataType : "json",//数据格式 
				type : "post",//请求方式
				async : false,//是否异步请求
				success : function(data) { //如果请求成功，返回数据。
					console.log(data);
					var html = "";
					var ca = data.data;

					var ls = ca[0];

					$("#id").val(ls.id);
					$(".username").val(ls.username);
					$("#boss").val(ls.boss);
					$("#tel").val(ls.tel);
					$("#address").val(ls.address);
					$("#jianjie").val(ls.jianjie);
				}
			})

		});

		/* 修改个人信息提交 */
		function submit1() {	
		var username=getCookie("username");
		$.ajax({ //几个参数需要注意一下
			type : "POST",//方法类型
			dataType : "json",//预期服务器返回的数据类型
			url : "company/doUpdateCompanyByUserName?username="+username,//url
			data : $('#form1').serialize(),
			success : function(data) {
			//console.log(data);
			alert("提交成功");
				//window.location.href = "welcome";
			},
			error : function() {
				alert("异常！");
			}
		});
	}
		
		
		
		/* 修改密码是的ajax */
		function login() {
			var params = {
				pwd : $("#oldpassword").val(),
				newPwd : $("#password").val(),
				cfgPwd : $("#password1").val(),
			}
			if (params.newPwd != params.cfgPwd) {
				alert("两次密码输入不一致，请重新输入")
				return;
			}
			var url = "user/doUpdatePassword";
			$.post(url, params, function(result) {
				if (result.state == 1) {
					alert("修改成功")
					location.reload();
				} else {
					alert(result.message);
				}
				return false;//防止刷新时重复提交
			});
		}

		//下面的js是切换页面 重要切记勿删除
		layui.use([ 'form', 'element' ], function() {

		});
	</script>
</body>
</html>